<form [formGroup]="form">
    <mat-card>
        <h1>
            @if(isEditMode()) { Edit details }
            @else {Enter details}
        </h1>

        <mat-form-field>
            <mat-label for="name">Name</mat-label>
            <input matInput id="name" type="text" formControlName="recipeName" />
            @if(form.get('recipeName')?.invalid) {
            <mat-error></mat-error>
            }
        </mat-form-field>

        <mat-form-field>
            <mat-label for="prepTime">Preparation Time</mat-label>
            <input matInput id="prepTime" type="number" formControlName="prepTime" />
            @if(form.get('prepTime')?.invalid){
            <mat-error></mat-error>
            }
        </mat-form-field>


        <form formArrayName="ingredients">
            <mat-label for="ingredients">Ingredients</mat-label>

            @for(ing of _ingredients.controls; track $index; let i = $index)
            {
            <div [formGroupName]="i">
                <mat-form-field>
                    <input matInput formControlName="name" placeholder="Item" class="input-name">
                </mat-form-field>
                <mat-form-field>
                    <input matInput formControlName="quantity" placeholder="Quantity" class="input-quantity">
                </mat-form-field>
                <button matMiniFab type="button" (click)="_ingredients.removeAt(i)">
                    <mat-icon>remove</mat-icon>
                </button>
            </div>

            @if(ing.get('name')!.invalid || ing.get('quantity')!.invalid){
            <mat-error> Provide the missing details </mat-error>
            }
            }
            @if(_ingredients.length < 2) { <mat-error> At least 2
                ingredients</mat-error>
                }

                <button matMiniFab type="button" (click)="addIngredient()"
                    [disabled]="!_ingredients.at(_ingredients.length - 1).valid">
                    <mat-icon>add</mat-icon>
                </button>
        </form>

        <mat-form-field>
            <mat-label for="description">Description</mat-label>
            <textarea matInput id="description" formControlName="description" rows="4">
            </textarea>
            @if(form.get('description')?.invalid){
            <mat-error></mat-error>
            }

        </mat-form-field>
        <mat-card-actions class="actions">
            <button matButton type="submit" (click)="onSubmit()">
                @if(isEditMode()){ Save Recipe }
                @else { Add Recipe }
            </button>
            <button matButton type="button" (click)="onCancel()">Cancel</button>
        </mat-card-actions>
    </mat-card>
</form>